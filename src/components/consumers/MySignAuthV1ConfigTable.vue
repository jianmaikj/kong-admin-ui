<template>
  <div id="config">
    <Row style="margin-bottom: 10px">
      <Col span="12"><h1>MySignAuthV1 Credentials:</h1></Col>
      <Col span="12" style="text-align:right;position: absolute;top: 50%;right: 0px">
        <Button type="primary" size="small" @click="showModal=true">Create a Credential</Button>
      </Col>
    </Row>


    <Table border :columns="columns" :data="configList">
      <template slot-scope="{ row }" slot="name">
        <strong>{{ row.name }}</strong>
      </template>
      <template slot-scope="{ row }" slot="action">
        <Button type="error" size="small" @click="deleteDialog(row.id)">Delete</Button>
      </template>
    </Table>

    <Modal
        @on-ok="addCredential"
        title="Add HMAC Auth Credential"
        v-model="showModal">
      <Form :model="formItem" :label-width="120" style="margin-top: 20px">
        <FormItem label="key:">
          <Input v-model="formItem.key" placeholder="Enter key ..." class="text_input"></Input>
        </FormItem>
        <FormItem label="secret:">
          <Input v-model="formItem.secret" placeholder="Enter secret ..." class="text_input"></Input>
        </FormItem>
      </Form>
    </Modal>

  </div>
</template>

<script>
import moment from 'moment'

export default {
  name: "MySignAuthV1ConfigTable",
  props: ['consumerId'],
  data() {
    return {
      configList: [],
      formItem: {
        key: '',
        secret: ''
      },
      columns: [
        {
          title: 'id',
          key: 'id'
        },
        {
          title: 'key',
          key: 'key',
          width: 100
        },
        {
          title: 'secret',
          key: 'secret',
          width: 100
        },
        {
          title: 'created_at',
          key: 'createAtStr',
          width: 150
        },
        {
          title: 'Action',
          slot: 'action',
          fixed: 'right',
          width: 150,
          align: 'center'
        }
      ],
      showModal: false
    }
  },
  mounted() {
    this.loadCredential();
  },
  methods: {
    loadCredential() {
      this._get('/consumers/' + this.consumerId + '/my-sign-auth-v1', response => {
            this.configList = response.data.data;
            this.configList.map(function (config) {
              let createDate = moment.unix(config.created_at);
              config.createAtStr = createDate.format('YYYY-MM-DD HH:mm:ss');
            });

          }, err => {
            console.log('error>>', err)
          }
      );
    },
    addCredential() {
      this._post('/consumers/' + this.consumerId + '/my-sign-auth-v1', this.formItem, () => {
        this.loadCredential();
      });
    },
    deleteDialog(credentialId) {
      let _this = this;
      this.$Modal.confirm({
        title: 'Delete Credential',
        content: '<p>Are you sure you would like to delete</p>' + '<p style="font-weight: bold">' + credentialId + '</p>',
        onOk: () => {
          _this._delete('/consumers/' + this.consumerId + '/my-sign-auth-v1/' + credentialId, () => {
            _this.$Message.info('Credential deleted!');
            _this.loadCredential();
          });
        },
        onCancel: () => {


        }
      });
    },
  }
}
</script>

<style scoped>
#config {
  margin-top: 10px;
}
</style>
